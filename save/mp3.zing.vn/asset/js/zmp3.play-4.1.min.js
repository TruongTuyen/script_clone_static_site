
var zmp3Embed={create:function(a,d,f,b){var e=$("#embedUrl").val();if(f===true){e+="?start=true"}if(b){var c='<object width="'+d+'" height="'+a+'">';c+='<param name="movie" value="'+e+'" />';c+='<param name="quality" value="high" />';c+='<param name="wmode" value="transparent" />';c+='<param name="allowfullscreen" value="true"/>';c+='<param name="allowscriptaccess" value="always"/>';c+='<embed allowscriptaccess="always" allowfullscreen="true" width="'+d+'" height="'+a+'" src="'+e+'" quality="high" wmode="transparent"></embed>';c+="</object>";c+="<br />";$("#embed").val(c)}else{$("#embed").val('<iframe scrolling="no" width="'+d+'" height="'+a+'" src="'+e+'" frameborder="0" allowfullscreen="true"></iframe>')}}};$(document).ready(function(){zmp3Embed.create($("#embedHeight").val(),$("#embedWidth").val(),$("#autoPlay").prop("checked"),$("#oldStyle").prop("checked"));$("#embedSize").change(function(){if($(this).val().length>2){var a=$(this).val().split("x");$("#embedHeight").val(a[1]);$("#embedWidth").val(a[0]);zmp3Embed.create($("#embedHeight").val(),$("#embedWidth").val(),$("#autoPlay").prop("checked"),$("#oldStyle").prop("checked"))}});$(".fn-input-number").keydown(function(a){return isInputNumber(a.keyCode)});$("#embedBox input").change(function(){zmp3Embed.create($("#embedHeight").val(),$("#embedWidth").val(),$("#autoPlay").prop("checked"),$("#oldStyle").prop("checked"))});zmp3Lyrics.init();zmp3Player.init();zmp3Rec.init();zmp3Artist.init();zmp3Like.init();zmp3Report.init()});var zmp3Player={width:[980,650],height:[590,404],isExpand:false,ord:0,ratio:1.7778,player:null,repeat:0,playTime:0,isHTML5Support:function(){if(Browser.getFlashVersion()<10||!MP3.IS_PC||location.search.search("html5")!=-1){return true}var c=/\/(bai-hat|album|playlist)/i;if(location.search.indexOf("html5")!==-1){return true}if(!c.exec(location.pathname)){return false}var b=false;var a=0;switch(true){case navigator.userAgent.indexOf("OPR/")>0:case navigator.userAgent.indexOf("pera/")>0:case navigator.userAgent.indexOf("hrome")>0:case navigator.userAgent.indexOf("dge/")>0:b=true;break;case (a=navigator.userAgent.indexOf("irefox/"))>0:a=parseFloat(navigator.userAgent.substring(a+7));if(a>25){b=true}break;case (a=navigator.userAgent.indexOf("afari/"))>0:a=parseFloat(navigator.userAgent.substring(a+6));if(a>8){b=true}break;case (a=navigator.userAgent.indexOf("MSIE 1"))>0:b=true;break}return b},init:function(){if(typeof playerDisplay!="undefined"){if(parseInt(zmp3Storage.getParam("_zpAuto",1))!=0){$(".fn-autoplay").removeClass("btn-sw-off").addClass("btn-sw-on")}else{$(".fn-autoplay").removeClass("btn-sw-on").addClass("btn-sw-off")}$(".fn-autoplay").click(function(){if(parseInt(zmp3Storage.getParam("_zpAuto",0))>0){zmp3Storage.setParam("_zpAuto",0);$(this).removeClass("btn-sw-on").addClass("btn-sw-off")}else{zmp3Storage.setParam("_zpAuto",1);$(this).removeClass("btn-sw-off").addClass("btn-sw-on")}return false});this.repeat=parseInt(zmp3Storage.getParam("_zpRe",this.repeat));if(isNaN(this.repeat)){this.repeat=0}if(this.isHTML5Support()){playerDisplay(function(){},true)}else{var a=this;playerDisplay(function(){a.player=document.getElementById("player");a.ratio=$(a.player).width()/$(a.player).height();if(!a.isVideo()&&$(".fn-playlist-item").length){$(".fn-playlist-item a.fn-name").click(function(b){zmp3Player.playItem(parseInt($(this).data("order")));return false})}else{$("#playlistItems .fn-next").click(function(){zmp3Player.nextVideo();return false});$("#playlistItems .fn-prev").click(function(){zmp3Player.prevVideo();return false});$("#playlistItems .fn-repeat").click(function(){zmp3Player.changeRepeat();return false})}zmp3Player.resize();$(window).resize(function(){zmp3Player.resize()});a.repeatStatus()})}}},repeatStatus:function(){$(".fn-repeat").addClass("none");var a=$(".fn-repeat.fn-none");switch(parseInt(this.repeat)){case 1:a=$(".fn-repeat.fn-one");break;case 2:a=$(".fn-repeat.fn-all");break;case 3:a=$(".fn-repeat.fn-shuffle");break}a.removeClass("none")},getLast:function(){var c=[],a=0;var b=zmp3Storage.getParam("_zpHis","0");if(b){c=b.split(",");a=parseInt(c.pop())}zmp3Storage.setParam("_zpHis",c.join(","));return isNaN(a)?0:a},setLast:function(a){var c=[];var b=zmp3Storage.getParam("_zpHis","0");if(b){c=b.split(",");if(c.length>19){c.splice(1,1)}}c.push(a);zmp3Storage.setParam("_zpHis",c.join(","))},setUrl:function(b){var e="";if(b>1){var d=location.search.replace("?","");if(d.length>0){var f=d.split("&"),c=false;for(var a in f){if(f[a].indexOf("st")===0){f[a]="st="+b;c=true}}if(!c){f.push("st="+b)}e="?"+f.join("&")}else{e="?st="+b}}if(typeof history.replaceState==="function"){history.replaceState({state:1,rand:Math.random()},document.title,e)}else{location.hash="st="+b}},playItem:function(a){this.focusItem(a);this.player.PlayAt(a)},focusItem:function(a){a=parseInt(a);if(isNaN(a)){a=1}var e=document.title.split("|");var d=$("#playlistItems");var c=location.href;if($(".fn-playlist-item").length>0){$(".fn-playlist-item").removeClass("playing").removeClass("pause").removeClass("fn-current");var b=$(".fn-playlist-item[data-order="+(a<10?"0"+a:a)+"]").addClass("playing").addClass("fn-current");if(a!==this.ord){c=$("a.fn-name",b).attr("href");zmp3Common.trackPageview(c);z3Log.start(b.data("id"),"song",35000);zmp3Player.setUrl(a);if(d.offset().top+d.height()<=b.offset().top||d.offset().top>b.offset().top){d.mCustomScrollbar("scrollTo",b)}if(e.length>2){e[0]=$("a.fn-name",b).attr("title");document.title=e.join(" | ")}else{document.title=$("a.fn-name",b).attr("title")+" | "+document.title}zmp3Lyrics.getLyrics(b.data("id"),false,$("a.fn-name",b).attr("title"))}if(typeof z3AdLog!="undefined"){z3AdLog.start(b.data("id"),"song")}}else{if(typeof z3AdLog!="undefined"){z3AdLog.start(0,"song")}}this.ord=a},pauseItem:function(a){$(".fn-playlist-item").removeClass("playing");$(".fn-playlist-item[data-order="+(a<10?"0"+a:a)+"]").addClass("pause")},loadFail:function(a,c){var f="";var d="song";if($(".fn-playlist-item").length){f=$('.fn-playlist-item[data-order="'+arg+'"]').data("id");playItem(a+1);d="playlist"}else{var e=/\/([a-z0-9]+).html/i;var b=e.exec(location.pathname);if(b[1]){f=b[1]}if(location.pathname.search("/video-clip/")!==-1){d="video"}}zmCore.get(MP3.LOG_URL+"log/error404?type="+d+"&id="+f+"&url="+c)},expand:function(a){this.isExpand=a;this.resize();zmp3Storage.setParam("_zpEx",a?1:0)},resize:function(){var c,a;$(".player").css("width","auto");$("body").removeClass("expand");if(this.ratio<2.5){c=this.width[0];a=this.height[0];var d=$(window).height();var e=this.isExpand?$(window).width():zmp3UI.getContentWidth();var b=1;while(b<3&&(c>e||a>d)){c=this.width[b];a=this.height[b++]}if(this.isExpand){$(".player").css("width",c+"px");$("body").addClass("expand")}}else{c=zmp3UI.getContentWidth();a=Math.floor(c/this.ratio)}$(this.player).attr("width",c).attr("height",a)},getCurrentPos:function(){return parseInt($(".fn-playlist-item.playing").data("order"))},isVideo:function(){return this.ratio<2.5},isPlaylist:function(){return $(".fn-playlist-item").length>0},getItemAt:function(a){return $(".fn-playlist-item[data-order="+(a<10?"0"+a:a)+"]")},getRandomPos:function(){return Math.ceil(Math.random()*$(".fn-playlist-item").length)},nextVideo:function(d){var b=d&&this.repeat===1;if(this.isVideo()&&this.isPlaylist()&&!b){var c=this.getCurrentPos();if(isNaN(c)){c=0}if(this.repeat===3){var a;do{a=this.getRandomPos()}while(a===c);this.playVideo(a)}else{this.playVideo(c+1)}this.setLast(c)}else{if(b){this.player.Play()}}},prevVideo:function(){if(this.isVideo()&&this.isPlaylist()&&this.repeat!==1){this.playVideo(this.getLast())}else{if(this.repeat!==0){this.player.Play()}}},playVideo:function(b){var a=$(".fn-playlist-item").length;if(b<1){this.playVideo(a)}else{if(b>a){this.playVideo(1)}else{location.href=$("a",this.getItemAt(b)).attr("href")}}},changeRepeat:function(){if(this.repeat===3){this.repeat=0}else{this.repeat++}zmp3Storage.setParam("_zpRe",this.repeat);this.repeatStatus()}};ZingPlayer={playTime:0,playlistScroll:null,isPaused:false,_counter:0,upnext:function(){if(parseInt(zmp3Storage.getParam("_zpAuto",1))!=0){var a=$("#songRec .fn-item").first();if(a.length>0){return JSON.stringify({title:a.data("name"),description:a.data("artist"),delay:3,link:$($("a.fn-link",a)[0]).attr("href")})}}},Error:function(b,a){MP3Player.loadFail(a,b)},error:function(a){},StreamError:function(c,a){var b=c.url;zmp3Player.loadFail(a,b)},Complete:function(){zmp3Player.nextVideo(true)},Time:function(a){if(a%10==0){this.playTime++}},Play:function(a){this.playTime=this.currentTime=0;zmp3Player.focusItem(a)},Next:function(a){this.Play(a)},Pause:function(a){zmp3Player.pauseItem(a)},Prev:function(a){this.Play(a)},AdLoad:function(a){},AdClick:function(a){},Expand:function(){zmp3Player.expand(true)},expand:function(){return false},UnExpand:function(){zmp3Player.expand(false)},RequireVip:function(){ZVip.Fpackage();return"Chức năng này chỉ dành cho VIP User"},volume:function(a){if(typeof(a)=="number"){zmp3Storage.setParam("_zpVol",a)}else{return zmp3Storage.getParam("_zpVol")}},quality:function(a){if(typeof(a)=="number"){zmp3Storage.setParam("_zpBit",a)}else{return zmp3Storage.getParam("_zpBit")}},Loop:function(b,d){var a="_zpLoop."+b;var c="";if(typeof(b)!=="string"){return"none"}if(window.localStorage){if(typeof(d)==="string"){localStorage.setItem(a,d)}else{c=localStorage.getItem(a);if(c===null){switch(b){case"song":c="one";break;case"video":c="none";break;case"album":c="all";break}}}return c}else{return 0}},VASTurl:function(){return MP3.MP3_URL+"xml/ads/vast"}};var zmp3Lyrics={songId:0,isInitUpload:false,tpl:null,init:function(){$("#newLyrics form").submit(function(){zmp3Lyrics.postnew(this);return false});this.itemInit($("#lyrics"));$(".fn-reportlyrics").click(function(){var a=location.href;var b=$("#playlistItems .fn-current a.fn-name");if(b.length>0){a=b.attr("href")}zmp3FeedBack.post(1,"Lyrics chưa chính xác",a,function(c){zmp3UI.showMsg(c.msg,c.code?1:0)});return false})},itemInit:function(a){$(".fn-new",a).click(function(){var b=$(this).data("new");if(typeof plupload=="undefined"){loadScript("/plugins/plupload/plupload.full.min.js",function(){zmp3Lyrics.initUploadLRC("lrcUpload","lrcUploadBox");zmp3Lyrics.newBoxShow(b)})}else{zmp3Lyrics.newBoxShow(b)}return false});$(".fn-next",a).click(function(){zmp3Lyrics.show($($(this).data("item")));return false});$(".fn-prev",a).click(function(){zmp3Lyrics.show($($(this).data("item")));return false});$(".fn-delete",a).click(function(){var c=$("#lyrics .fn-lyrics");for(var b=0;b<c.length;b++){if(!$(c[b]).hasClass("none")){zmp3Lyrics.remove($(c[b]));break}}return false})},postnew:function(a){if(a.content.value.trim().length<200||a.content.value.trim().length>4000){zmp3UI.showMsg("Nội dung cần ít nhất 200 ký tự và tối đa 4000 ký tự!",1)}else{if(!$(a).data("processing")){$(a).data("processing",true);$.post($(a).attr("action"),$(a).serialize(),function(b){if(b.code<1){a.reset();$("#newLyrics").addClass("none");zmp3Lyrics.getLyrics(zmp3Lyrics.songId,true)}zmp3UI.showMsg(b.msg,b.code);$(a).data("processing",false)},"json")}}return false},getLyrics:function(a,b){if(a){a=a.toLowerCase()}if(this.tpl===null){this.tpl=$(".fn-lyrics")[0].cloneNode(true,true);$(this.tpl).removeClass("none")}if(b){$(".fn-lyrics"+a).remove()}if($(".fn-lyrics"+a).length<1){if(this.songId!=a||b){this.songId=a;$.get(MP3.MP3_URL+"/xhr/song/get-lyrics",{songid:this.songId},function(c){if(c.data){if(c.total>0){for(x in c.data){zmp3Lyrics.buildItem(a,c.data[x],x,c.total)}ZMEInfo.renderZMEAvatar()}else{var d=zmp3Lyrics.tpl.cloneNode(true,true);$(d).attr("id","lyrics"+a+1).addClass("fn-lyrics fn-lyrics"+a);$(".fn-nolyrics").removeClass("none");$(".fn-wlyrics").addClass("none");$("#lyrics .fn-container").append(d)}zmp3Lyrics.show($("#lyrics"+a+"1"));zmp3Lyrics.itemInit(".fn-lyrics"+a)}},"json")}}else{zmp3Lyrics.show($("#lyrics"+a+"1"))}},remove:function(a){$.post("/xhr/mydata/delete-lyrics",a.data(),function(b){if(b.code<1){$(".fn-content",a).addClass("disabled")}zmp3UI.showMsg(b.msg,b.code)},"json")},buildItem:function(f,e,a,c){a=parseInt(a)+1;var d=zmp3Lyrics.tpl.cloneNode(true,true);var b="lyrics"+f+a;$(d).attr("id",b).addClass("fn-lyrics fn-lyrics"+f).data("songid",f).data("id",e.id);$(".fn-name",d).html((e.name+" - "+e.artist).substring(0,66));$(".fn-content",d).html(e.content);$(".fn-version",d).html(a+"/"+c);$("#lyrics .fn-container").append(d);if(a<c){$(".fn-next",d).removeClass("disabled").data("item","#lyrics"+f+(a+1)).click(function(){zmp3Lyrics.show($($(this).data("item")));return false})}else{$(".fn-next",d).addClass("disabled")}if(a>1){$(".fn-prev",d).removeClass("disabled").data("item","#lyrics"+f+(a-1)).click(function(){zmp3Lyrics.show($($(this).data("item")));return false})}else{$(".fn-prev",d).addClass("disabled")}$(".fn-user",d).html(e.user);$(d).append('<i class="fn_zme_info fn'+e.user+'" style="display: none;" data-ref=".fn'+e.user+'" data_uname="'+e.user+'" data-dname="#'+b+' .fn-user"></i>');$("#lyrics .fn-container").append(d)},show:function(a){$(".fn-lyrics").addClass("none");if($(".fn-content",a).html().length<10){$(".fn-nolyrics").removeClass("none");$(".fn-wlyrics").addClass("none")}else{$(".fn-nolyrics").addClass("none");$(".fn-wlyrics").removeClass("none")}a.removeClass("none");return false},newBoxShow:function(a){var c=$(".fn-playlist-item.fn-current");var b=$("#newLyrics form")[0];if(c.length>0){b.song_id.value=c.data("id");zmp3Lyrics.songId=c.data("id")}$("#newLyrics").removeClass("none");if(a=="lrc"){zmp3Tab.showTab($('.fn-tab[data-panel=".fn-sub-lrc"]'))}else{zmp3Tab.showTab($('.fn-tab[data-panel=".fn-sub-lyrics"]'))}},initUploadLRC:function(c,a){a=$("#"+a)[0];var b=new plupload.Uploader({browse_button:c,runtimes:"html5,html4",url:$("#"+c).data("url"),multi_selection:false,filters:{max_file_size:"10mb",mime_types:[{title:"LRC files",extensions:"lrc"}]},init:{FilesAdded:function(d,f){var e=$(d.settings.browse_button[0]);plupload.each(f,function(h){$(a).attr("id",h.id);$(".fn-name",a).html(h.name);$(".fn-upload-fail",a).addClass("none");$(".fn-save",a).addClass("disabled").html("Vui lòng chờ");var g=new plupload.Uploader({browse_button:"uploadTmp",runtimes:"html5,html4",url:e.data("url"),init:{UploadProgress:function(i,j){$(".fn-save",a).html("Vui lòng chờ, đang upload "+Math.floor(j.percent)+"%")},FileUploaded:function(i,k,j){j=$.parseJSON(j.response);if(!j.errorCode){$(".fn-save",a).data("filename",j.data.filename).removeClass("disabled").html("Gửi")}},Error:function(i,j){$(".fn-upload-fail",a).removeClass("none")}}});g.init();g.addFile(h);setTimeout(function(){g.start()},200)})}}});b.init();$(".fn-save",a).click(function(){var d=$(this);if(!d.hasClass("disabled")){d.addClass("disabled").html("Vui lòng chờ");$.post(d.data("url"),d.data(),function(e){if(e.code<1){$("#newLyrics").addClass("none")}zmp3UI.showMsg(e.msg,e.code);d.html("Gửi")},"json")}return false})}};var zmp3Rec={init:function(){$(".fn-rec").click(function(){zmp3Rec.rec($(this));return false})},rec:function(b){var c=$(b.data("item"));if(!c.data("loading")){c.data("loading",true);var a=$(".fn-item",c).last()[0].cloneNode(true);$.getJSON("/xhr/rec/get-rec",c.data(),function(d){if(d.data){var g=parseInt(c.data("start"))+d.data.length;if(g>=d.total){b.remove()}if(d.data.length>0){c.data("start",g);for(var e in d.data){var f=zmp3UI.buildItem(a.cloneNode(true),d.data[e],"songrec");$(".fn-list",c).append(f)}zmp3SongTool.init()}}c.data("loading",false)})}}};var zmp3Artist={init:function(){var a=$("#albumOfArtist");var b=$("#videoOfArtist");$(".fn-list",a).slick({dots:false,prevArrow:$(".fn-prev",a),nextArrow:$(".fn-next",a),infinite:false,speed:1000,slidesToShow:4,slidesToScroll:4});$(".fn-list",b).slick({dots:false,prevArrow:$(".fn-prev",b),nextArrow:$(".fn-next",b),infinite:false,speed:1000,slidesToShow:4,slidesToScroll:4});$(".fn-list",a).on("beforeChange",function(f,d,g,c){var e=a.data("total");if(e>d.slideCount&&d.slideCount-c<6){$.get("/xhr/artist/get-album",{id:a.data("id"),userid:a.data("uid"),start:d.slideCount,length:8},function(h){var j=$(".fn-item",a).last()[0].cloneNode(true);if(h.data&&h.data.length>0){for(var k in h.data){var m=j.cloneNode(true);var l=h.data[k];m=zmp3UI.buildItem(m,l);if(l.badge){$(".fn-badge",m).addClass(l.badge)}$(".fn-list",a).slick("slickAdd",$(m))}}})}})}};var zmp3Like=(function(){var a=null;var f=0;var b=1;function g(j){}function c(j){$(".fn-count",a).html(zmp3Number.format(j))}function d(j){$.getJSON("http://like.mp3.zing.vn/get?uid="+MP3.ACCOUNT_ID+"&sid="+a.data("key")+"&token="+a.data("token")+"&callback=?",function(l){if(typeof l==="object"){var k=$(".fn-btn",a);k.html((l.like?k.html().replace("Thích","Bỏ thích"):k.html().replace("Bỏ thích","Thích")));f=l.total;c(f);if(l.like){a.data("like",1)}else{a.data("like",0)}if(j){j()}}})}function h(j){$.getJSON("/xhr/like/token?id="+a.data("id")+"&callback=?",{dataType:"json"},function(k){if(!k.error){a.data("token",k.token);a.data("key",k.key);if(j){j()}}})}function i(){d(function(){$(".fn-btn",a).click(function(){if(!MP3.ACCOUNT_ID){return zmp3Login.show(function(){zmp3Like.getToken(function(){zmp3Like.stats()})})}else{e($(this))}return false});$(".fn-count",a).click(function(){b=1;$.getJSON("http://like.mp3.zing.vn/list?uid="+MP3.ACCOUNT_ID+"&sid="+a.data("key")+"&token="+a.data("token")+"&page="+b+"&count=10&callback=?",function(j){if(j.result.total>0){g(j)}})})})}function e(){var j="";if(a.data("like")!=1){j="http://like.mp3.zing.vn/like?uid="+MP3.ACCOUNT_ID+"&sid="+a.data("key")+"&token="+a.data("token")+"&callback=?"}else{j="http://like.mp3.zing.vn/unlike?uid="+MP3.ACCOUNT_ID+"&sid="+a.data("key")+"&token="+a.data("token")+"&callback=?"}$.getJSON(j,function(l){if(typeof l==="object"&&!l.error){var k=$(".fn-btn",a);if(a.data("like")!=1){k.html(k.html().replace("Thích","Bỏ thích"));a.data("like",1);f++}else{k.html(k.html().replace("Bỏ thích","Thích"));a.data("like",0);f--}c(f)}})}return{init:function(){a=$($(".fn-zlike")[0]);if(a.length<1){return}i()},stats:function(){d()},getToken:function(j){h(j)}}})();var zmp3Report={init:function(){$("input[name=_reportType]").click(function(){if($(this).val()=="other"){$("#_errorContent").removeClass("none")}else{$("#_errorContent").addClass("none")}});$("#_btnReportSubmit").click(function(){zmp3Report.sendReport($(this));return false})},sendReport:function(a){zmp3Login.show(function(){var b=true;$("input[name=_reportType]").each(function(){if($(this).prop("checked")){$(this).prop("checked",false);var c=$(this).val();if(c=="other"){c=$("#_errorContent").val()}if(c.length>5){b=false;zmp3FeedBack.post(1,c,location.href,function(d){zmp3UI.showMsg(d.msg,d.code?1:0)})}}});if(b){zmp3UI.showMsg("Vui lòng cho biết vấn đề bạn gặp phải!",1)}})}};